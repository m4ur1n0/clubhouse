<div class="container py-4">
  <% if notice.present? %>
    <div class="alert alert-success"><%= notice %></div>
  <% end %>

  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1 class="h3 fw-bold mb-3"><%= @event.name %></h1>

          <p class="text-muted mb-2">
            <i class="bi bi-clock me-1"></i>
            <strong>Date:</strong>
            <%= @event.date.strftime("%B %d, %Y at %I:%M %p") if @event.date %>
          </p>

          <% if @event.location.present? %>
            <p class="text-muted mb-2">
              <i class="bi bi-geo-alt me-1"></i>
              <strong>Location:</strong>
              <%= @event.location %>
            </p>
          <% end %>

          <p class="text-muted mb-2">
            <i class="bi bi-file-text me-1"></i>
            <strong>Description:</strong>
            <% if @event.description.present? %>
              <%= simple_format(@event.description) %>
            <% else %>
              <em>No description given for this event</em>
            <% end %>
          </p>
        </div>
        <div class="card-footer bg-white">
          <div class="d-flex gap-2">

            <%= link_to @event.club, class: "btn btn-outline-secondary" do %>
              <i class="bi bi-arrow-left me-1"></i> Back to club
            <% end %>
            <%= link_to edit_event_path(@event), class: "btn btn-outline-warning" do %>
              <i class="bi bi-pencil-fill me-1"></i> Edit
            <% end %>

            

            <%= button_to "Destroy this event", @event, method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger ms-auto" %>
          </div>
        </div>
      </div>

      <div class="card shadow-sm mt-4 mb-5">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h2 class="h3 mb-0 d-flex align-items-center">
            <i class="bi bi-people me-2"></i>
            Attendees (<%= @event.users_attending.length %>)
          </h2>

          <% if current_user.nil? %>
            <%= link_to "Log in with Google to RSVP",
                    google_login_path(return_to: rsvp_start_event_path(@event)),
                    class: "btn btn-primary" %>

          <% elsif !@event.user_attending?(current_user) %>
            <%= button_to "RSVP",
                    rsvp_event_path(@event),
                    method: :post,
                    class: "btn btn-success" %>

          <% else %>
            <%= button_to "Un-RSVP",
                    unrsvp_event_path(@event),
                    method: :delete,
                    class: "btn btn-danger" %>
          <% end %>

        </div>

        <div class="card-body w-100">
          <% if @event.users_attending.any? %>
            <div class="row g-2 ">
              <% @event.users_attending.each do |user_id| %>
                <% user = User.find_by(id: user_id) %>
                <% if user %>
                  <div class="col-sm-6 col-md-4">
                    <div class="card h-100">
                      <div class="card-body d-flex align-items-center gap-2">
                        <i class="bi bi-person-circle" style="font-size: 1.6rem;"></i>
                        <span class="fw-medium text-nowrap"><%= user.name %></span>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>

          <% else %>
            <p class="text-muted mb-0">No one has RSVPd to this event yet.</p>
          <% end %>

        </div>

      </div>
    </div>
  </div>

  <% if @auto_rsvp %>
    <form id="auto-rsvp" action="<%= rsvp_event_path(@event) %>" method="post" style="display:none;">
        <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    </form>

    <script>
        document.getElementById("auto-rsvp").submit();
    </script>
  <% end %>


</div>
